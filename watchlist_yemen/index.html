<!doctype html>
<html>

<head>

<script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>

<!-- Load Carto's code so we can pull in our Carto maps. -->

  <!-- EB removed this: it overrides too many styles -->
  <!-- <link rel="stylesheet" href="https://cartodb-libs.global.ssl.fastly.net/cartodbui/assets/4.6.25/stylesheets/deep_insights.css" /> -->
    
<link rel="stylesheet" href="https://cartodb-libs.global.ssl.fastly.net/cartodb.js/v3/3.15/themes/css/cartodb.css" />
    
  <!-- EB removed this: it's going to break the legend a bit, but this code overrides too many styles -->
  <!-- <link rel="stylesheet" href="https://cartodb-libs.global.ssl.fastly.net/cartodbui/assets/4.6.25/stylesheets/public_editor3.css" /> -->
       
 <link rel="stylesheet" type="text/css"
      href="https://fonts.googleapis.com/css?family=Cardo">
    
<link rel="stylesheet" type="text/css"
      href="https://fonts.googleapis.com/css?family=Garamond">

<link rel="stylesheet" type="text/css"
      href="https://fonts.googleapis.com/css?family=Lato">
    
<link rel="stylesheet" type="text/css"
      href="https://fonts.googleapis.com/css?family=Roboto">    
    
    
<style>

html, body {
    height: 100%;
    margin: 0;
    padding: 0;
    width: 100%;
}

#map {
    height: 100%;
    width: 100%;
}

#header {
    position: absolute;
    right: 0;
    display: flex;
    width: 75%;
    z-index:5;
    overflow: hidden;
    height: 63px;
    background-color: rgba(0,0,0,.33);
    justify-content: center;
    vertical-align: middle;
    align-content: center;
}
    
.sidepanel {
    background-color: #FFF;
    position: absolute;
    left: 0;
    bottom: 0;
    width: 25%;
    height: 100%;
    overflow: auto;
    display: flex;
    z-index: 5;
    border-right: solid #585858 1px;
}
    
.wrapper {
    display: block;
    padding: 4px 30px 0 30px; 
}    
 
#title-text {
    border-bottom: 5px solid black;
    border-bottom-style:double;
    text-align: center;
    font-size: 28px; 
    font-family: Lato;
    color: #b00836; 
}
    
.leaflet-left {
    left: 25%;
    top: 9.3%;
    position: absolute;
    }
 
/* CHECKBOX FILTERS */

.boxes {
  margin: auto;
  padding-top: 12px;
  padding-left: 12px;
  padding-right: 12px;    
    position: absolute;
        bottom: 2.5%;
        right: .75%;
    border-radius: 6px;
    width: 185px;
    border:1px solid #021a40; 
    background-color: #fff;
   -moz-box-shadow:    inset 0 0 2.5px #000000;
   -webkit-box-shadow: inset 0 0 2.5px #000000;
   box-shadow:         inset 0 0 2.5px #000000;
}

input[type="checkbox"] { display: none; }

input[type="checkbox"] + label {
  display: block;
  position: relative;
  padding-left: 35px;
  margin-bottom: 20px;
  font: 13px 'Lato', Arial, sans-serif;
  font-weight: 900;
  color: black;
  cursor: pointer;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
}

input[type="checkbox"] + label:last-child { margin-bottom: 0; }

input[type="checkbox"] + label:before {
  content: '';
  display: block;
  width: 16px;
  height: 16px;
  border: 2px solid #b00836;
  position: absolute;
  left: 0;
  top: 0;
  opacity: .6;
  -webkit-transition: all .12s, border-color .08s;
  transition: all .12s, border-color .08s;
}

input[type="checkbox"]:checked + label:before {
  width: 10px;
  top: -5px;
  left: 5px;
  border-radius: 0;
  opacity: 1;
  border-top-color: transparent;
  border-left-color: transparent;
  -webkit-transform: rotate(45deg);
  transform: rotate(45deg);
}     
    
/* ZOOM BUTTONS */
    
.buttons {
    position: absolute;
     left: 50%;
     top: 9.2%;
    display: inline-block;
}
    
.Yemen {
    border: none;
    text-align: center;
    text-decoration: none;
         font-size: 16px;
    background: none;
    font-weight: bolder;
    margin: 4px 2px;
    -webkit-transition-duration: 0.4s; /* Safari */
    transition-duration: 0.4s;
    cursor: pointer;
    color: black; 
    border: 2px solid #b00836;
    padding: 5px;
    font-family: 'Lato';
}

.Yemen:hover {
    background-color: #b00836;
    color: white;
}

.Yemen:focus {
    background-color: #b00836;
    color: white;
}    

.Sadah {
    border: none;
    text-align: center;
    text-decoration: none;
        font-size: 16px;
    background: none;
    font-weight: bolder;
    margin: 4px 2px;
    -webkit-transition-duration: 0.4s; /* Safari */
    transition-duration: 0.4s;
    cursor: pointer;
    color: black; 
    border: 2px solid #b00836;
    padding: 5px;
    font-family: 'Lato';
}

.Sadah:hover {
    background-color: #b00836;
    color: white;
}

.Sadah:focus {
    background-color: #b00836;
    color: white;
}
    
.Hajjah {
    border: none;
    text-align: center;
    text-decoration: none;
        font-size: 16px;
    background: none;
    font-weight: bolder;
    margin: 4px 2px;
    -webkit-transition-duration: 0.4s; /* Safari */
    transition-duration: 0.4s;
    cursor: pointer;
    color: black; 
    border: 2px solid #b00836;
    padding: 5px;
    font-family: 'Lato';
}

.Hajjah:hover {
    background-color: #b00836;
    color: white;
}

.Hajjah:focus {
    background-color: #b00836;
    color: white;
}

.Harad {
    border: none;
    text-align: center;
    text-decoration: none;
     font-size: 16px;
    background: none;
    font-weight: bolder;
    margin: 4px 2px;
    -webkit-transition-duration: 0.4s; /* Safari */
    transition-duration: 0.4s;
    cursor: pointer;
    color: black; 
    border: 2px solid #b00836;
    padding: 5px;
    font-family: 'Lato';
}

.Harad:hover {
    background-color: #b00836;
    color: white;
}

.Harad:focus {
    background-color: #b00836;
    color: white;
}     
    
.Sanaa {
    border: none;
    text-align: center;
    text-decoration: none;
        font-size: 16px;
    background: none;
    font-weight: bolder;
    margin: 4px 2px;
    -webkit-transition-duration: 0.4s; /* Safari */
    transition-duration: 0.4s;
    cursor: pointer;
    color: black; 
    border: 2px solid #b00836;
    padding: 5px;
    font-family: 'Lato';
}

.Sanaa:hover {
    background-color: #b00836;
    color: white;
}

.Sanaa:focus {
    background-color: #b00836;
    color: white;
}   
    
.Taiz {
    border: none;
    text-align: center;
    text-decoration: none;
      font-size: 16px;
    background: none;
    font-weight: bolder;
    margin: 4px 2px;
    -webkit-transition-duration: 0.4s; /* Safari */
    transition-duration: 0.4s;
    cursor: pointer;
    color: black; 
    border: 2px solid #b00836;
    padding: 5px;
    font-family: 'Lato';
}

.Taiz:hover {
    background-color: #b00836;
    color: white;
}

.Taiz:focus {
    background-color: #b00836;
    color: white;
}
    
.Aden {
    border: none;
    text-align: center;
    text-decoration: none;
        font-size: 16px;
    background: none;
    font-weight: bolder;
    margin: 4px 2px;
    -webkit-transition-duration: 0.4s; /* Safari */
    transition-duration: 0.4s;
    cursor: pointer;
    color: black; 
    border: 2px solid #b00836;
    padding: 5px;
    font-family: 'Lato';
}

.Aden:hover {
    background-color: #b00836;
    color: white;
}

.Aden:focus {
    background-color: #b00836;
    color: white;
}      

/* END ZOOM BUTTON STYLING */
    
    
/* ACCORDION STYLING */    
 
* {
  box-sizing:border-box;
}
@import url(http://fonts.googleapis.com/css?family=Lato:400,700);
body { 

  font-family:'Lato';
}
.heading-primary {
  font-size: 22px;
  padding:2em;
  text-align:center;
}
.accordion dl,
    .accordion-list {
   border:1px solid #ddd;
   &:after {
       content: "";
       display:block;
       height:1em;
       width:100%;
       background-color:darken(#b00836, 50%);
     }
}
.accordion dd,
.accordion__panel {
   background-color:#eee;
   font-size: 14px;
   line-height:1.5em; 
}
.accordion p {
  padding: 0em 2em 0em 0em;
}

.accordion {
    position:relative;
    background-color:#eee;
}
.container {
  max-width:960px;
  margin:0 auto;
    background-color: #fff;
}
.accordionTitle {
 background-color: #fff; 
   text-align:center;
     font-weight:700; 
          padding:2em;
          display:block;
          border:3px solid #b00836;    
          text-decoration:none;
          color: black;
          transition:background-color 0.5s ease-in-out;
}

.accordionTitle:hover {
    background-color: #b00836;
    color: white;
}

 
    
.accordionTitleActive,
.accordionTitle.isexpanded {
        background-color: #b00836;
    color: black;
    }
    
.accordionTitleActive,
.accordionTitle.is-collapsed {
        background-color: #b00836;
    color: white;
    }        

/*.accordionTitle:before {
          content: "+";
   font-size:1.5em;
   line-height:0.5em;
   float:left; 
   transition: transform 0.3s ease-in-out;
    }*/
      
.accordionItem {
    height:auto;
    overflow:hidden; 
    //SHAME: magic number to allow the accordion to animate
    
     max-height:50em;
    transition:max-height 1s;   
 
    
    @media screen and (min-width:48em) {
         max-height:15em;
        transition:max-height 0.5s
        
    }
      
}
 
.accordionItem.is-collapsed {
    max-height:0;
}
.no-js .accordionItem.is-collapsed {
  max-height: auto;
}
.animateIn {
     animation: accordionIn 0.45s normal ease-in-out both 1; 
}
.animateOut {
     animation: accordionOut 0.45s alternate ease-in-out both 1;
}
@keyframes accordionIn {
  0% {
    opacity: 0;
    transform:scale(0.9) rotateX(-60deg);
    transform-origin: 50% 0;
  }
  100% {
    opacity:1;
    transform:scale(1);
  }
}

@keyframes accordionOut {
    0% {
       opacity: 1;
       transform:scale(1);
     }
     100% {
          opacity:0;
           transform:scale(0.9) rotateX(-60deg);
       }
}   

/* 'ZOOM TO' DIV */    
#inner{
   width: 80%;
  margin: 0 auto;
    font-family: Lato;
  text-align: center;
    font-size: 22px; 
    text-transform: uppercase; 
    font-weight:900; 
    color:#b00836;
    -webkit-text-stroke: .25px black;
       }   
    
.sidebar-inner {
        padding: 15px;
    
      }    

.bullet1 {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    display: inline-block;
  }
    
.legend-list {
    list-style-type: none;
    text-align: left;
    margin-left: -40px;
    }
    
/* INFOWINDOWS */
    
.cartodb-popup.v2 {
    width:400px;
    max-height:425px;
     padding: 10px; 
    border-radius: 8px;
    color: white;
    font-family: Lato;
    font-size: 13px;
    }
    
.cartodb-popup-v3 {
    width:300px;
    max-height:450px;
     padding: 10px; 
    background: #222222;
    overflow-y:scroll;
    border-radius: 8px;
    color: white;
    font-family: Lato;
    font-size: 13px;
    }    

  div.cartodb-popup.v2 div.cartodb-popup-content-wrapper {
    padding-bottom: 14px;
    background-color: #222222;
  }
  
  div.cartodb-popup .jspContainer:after {
    background: none;
  }
  
  div.cartodb-popup .jspContainer:before {
    background: none;
  }
    
.cartodb-popup-v3 {
    width:250px;
    max-height:400px;
     padding: 10px; 
    background: #2E3C43;
    overflow-y:scroll;
    border-radius: 10px;
    color: white;
    }    
 
 div.cartodb-popup.v2 h3 {
    color: grey;
    text-transform:uppercase;
    font-size: 13px;
    padding-top: 15px;
     font-family: Lato;
    }   
    
 div.cartodb-popup.v2 h4 {
    color: grey;
    text-transform:uppercase;
    font-size: 13px;
      font-family: Lato;
    }     
    
</style>
    
</head>

<!-- HEADER -->    
    
<div id="header">
    <a href="http://watchlist.org/" target="_blank"> <img src="http://watchlist.org/wp-content/uploads/header-logo.png" width="300" height="62"> </a>
    </div>     
    
<!-- MAP -->    
    
<div id="map"></div>
    
<!-- ZOOM TO BUTTONS -->
    
  <div class="buttons">
    <div id="inner">Zoom to:</div>  
        <button class="Yemen">Yemen</button>
        <button class="Sadah">Sa'dah</button>
        <button class="Hajjah">Hajjah</button>
        <button class="Harad">Harad</button>
        <button class="Sanaa">Sana'a</button>
        <button class="Taiz">Taiz</button>
        <button class="Aden">Aden</button>
  </div>
    

<!-- CHECKBOX FOR LAYERS -->  
    
  <div class="boxes" style="padding-bottom:none;">
       <div class="legend-title" style="font-family: Lato; font-weight: 900; text-align: center; color: black; font-size: 15px; text-transform: none;padding-bottom:18px;font-weight: 800;" >Map Layer Selector</div> 
        
      <input type="checkbox" id="points" class="points-checkbox" checked="true">
  <label for="points">individual attacks</label>
      
      <input type="checkbox" id="poly" class="poly-checkbox" checked="true">
  <label for="poly">governorate data</label>

    
    
    
<!-- CHECKBOX FOR FILTERING POINTS -->  
   

     <div class="legend-title" style="font-family: Lato; font-weight: 900; text-align: center; color: black; font-size: 15px; text-transform: none;padding-bottom:18px;padding-top:10px;border-top: 3px solid black;border-top-style:dotted;" >Filter Attacks by Type</div> 
  <input type="checkbox" id="airstrike" class="airstrike-checkbox">
  <label for="airstrike">airstrike</label>

  <input type="checkbox" id="ground" class="ground-checkbox">
  <label for="ground">ground</label>

  <input type="checkbox" id="indiscriminate" class="indiscriminate-checkbox">
  <label for="indiscriminate">unidentified</label>
      
        


 <!--    POINTS LEGEND -->

  <div class="legend-title" style="font-family: Lato; font-weight: 900; text-align: center; color: black; font-size: 15px; text-transform: none;padding-top: 10px;border-top: 3px solid black;border-top-style:dotted;" >Health Facility Attacks</div> 
   
<ul class="legend-list">
      <li><div class="image" style="font-size: 14px; font-weight: 900; text-transform: lowercase; margin-bottom: 10px; font-family: Cardo; color:#b00836;">
<a href=""><img style= "vertical-align:middle" img src="https://d30y9cdsu7xlg0.cloudfront.net/png/163336-200.png" width="20" height="20" alt=""></a> airstrike</div></li>
      
    <li><div class="bullet" style="font-size: 14px; font-weight: 900; text-transform: lowercase; margin-bottom: 10px; font-family: Cardo; color:#b00836; font-weight: bold;">
<a href=""><img style= "vertical-align:middle" img src="https://d30y9cdsu7xlg0.cloudfront.net/png/659093-200.png" width="20" height="20" alt=""></a> ground attack</div></li>
      
    <li><div class="bullet" style="font-size: 14px; font-weight: 900; text-transform: lowercase; font-family: Cardo; color:#b00836; font-weight: bold;">
<a href=""><img style= "vertical-align:middle; color:#b00836;" img src="https://d30y9cdsu7xlg0.cloudfront.net/png/756341-200.png" width="20" height="20" alt=""></a>
unidentified attack</div></li>
  </ul>
        

<!--    POLYGON LEGEND -->
    
<span style= "padding-bottom:none;" class="cartodb-legend category">       
      
    <div class="legend-title" style="font-family: Lato; font-weight: 900; text-align: center; color: black; font-size: 14px; text-transform: none;border-top: 3px solid black;border-top-style:dotted;padding-top: 10px;" >% of Health Facilities at Diminished Capacity</div>
            
    <ul class ="legend-list" style="color:black;">
  
      <li style="font-size:14px;font-family:Cardo;font-weight:900;color:black;">
        <div class="bullet1" style="background-color:#ee4d5a;"></div>
        >75%
     </li>
      
      <li style="font-size:14px;font-family:Cardo;font-weight:bold;color:black;">
        <div class="bullet1" style="background-color:#f97b57;"></div>
        50% - 75%
      </li>
      
      <li style="font-size:14px;font-family:Cardo;font-weight:bold;color:black;">
          <div class="bullet1" style="background-color:#f3ad6a"></div> 25% - 49%
      </li>
        
      <li style="font-size:14px;font-family:Cardo;font-weight:bold;color:black;">
        <div class="bullet1" style="background-color:#ecda9a;" ></div>
        less than 25%
       </li>
     </ul>
   </span>
 </div>  
  
    
<!-- SIDEPANEL -->    
    
<div id="side-box" class="sidepanel">
    <div class="wrapper">
        <div id="title-text">
            <h1>YEMEN</h1>
                    </div>
            <div id="sidebar">
                
        
<!-- ACCORDION -->            

<div class="container" style= "padding-top: 15px;">
  <div class="accordion">
    <dl>
      <dt>
        <a href="#accordion1" aria-expanded="false" aria-controls="accordion1" class="accordion-title accordionTitle js-accordionTrigger" style ="font-size: 22px; padding: 20px; " >CONFLICT OVERVIEW</a>
              </dt>
          <dd class="accordion-content accordionItem is-collapsed" id="accordion1" aria-hidden="true" style="padding: 5px;">
            <p>The ongoing conflict in Yemen, which escalated sharply in March 2015, has led to the near collapse of the country's already fragile health care system.</p> 
            <p>The Office for the Coordination of Humanitarian Affairs (OCHA) reported in June 2016 that 50 percent of hospitals are either not functioning or partially functioning and 25 percent of all health facilities have shut down due to damages, or shortages of staff, medicines, and other resources. In addition, according to the World Health Organization (WHO), more than 100 health facilities have been attacked in the 12 months leading up to March 2016.</p>
            <p>This situation has vastly reduced children's access to health resources and has caused thousands of deaths from treatable diseases. </p>
            <p>Since March 2015, there has been a dramatic increase in the number of children directly injured by the conflict or suffering from acute malnutrition, acute respiratory infection (ARI), and diarrheal disease. By March 2016, 1.3 million children were at risk of ARI and 2.5 million children were at risk of diarrheal disease - figures that had at least doubled over the preceding 12 months of conflict.</p> 
            <p>According to UNICEF, as many as 10,000 children in Yemen under the age of five may have died in 2015 from preventable diseases as a result of the decline in key health services, such as immunizations against vaccine-preventable diseases and the treatment of diarrhea and pneumonia.</p> 
              </dd>
      <dt>
        <a href="#accordion2" aria-expanded="false" aria-controls="accordion2" class="accordion-title accordionTitle js-accordionTrigger" style ="font-size: 22px; padding: 20px;">
                  METHODS</a>
              </dt>
              <dd class="accordion-content accordionItem is-collapsed" id="accordion2" aria-hidden="true" style="padding: 5px;">
    <p>As part of the spatial analysis of the Yemeni conflict, Watchlist has compiled data and statistics from reports by a number of different organizations (OCHA, WHO, MSF, other NGOs, media outlets, etc.). The resulting map includes individual attacks and disruptions, as well as aggregate statistics at the governorate level. The period covered in this analysis is approximately March 2015 thru June 2016. Since data was not available for every governorate at the same point in time, statistics at this level are derived from different points throughout early-2015 to mid-2016.</p>                
   <p>Over this period, and as detailed in the map to the right, Watchlist has identified 52 instances of an attack or a disruption that is supported by official reporting. Clicking directly on any of the data points on the map will pull up an infowindow that provides details about these incidents, including a link to the supporting report. INSERT COMMENT ABOUT POLY INFOWINDOWS.</p>
   <p>It's important to note that, for a number of the individual incidents, the facility was either unnamed in the report or it was unable to be located on existing maps. Thus, the level of precision varies depending on the incident, ranging from rooftop level, to town/city, all the way to the governorate level. This means that some of the points on the map do not represent the actual location of that specific attack. The precision level is available in the infowindow of each point on the map.  </p>            
   <p>The individual incidents can be filtered by attack type by choosing any of the three checkboxes - airstrike, ground attack, or unidentified - located at the top left. Both map layers can also be turned on or off by using the map layer selector located above the attack filter. Unchecking the governorate data layer, for instance, will leave just the individual attack data layer, which is then visible on top of satellite imagery, providing the user with a street-view perspective of where attacks occurred. </p>          
   <p>Due to gaps in the reporting process caused by the overall difficulty of data collection in Yemen, 
   these incidents make up only a fraction of the total number of health facility attacks.</p>
              </dd>
        
              <dt>
                <a href="#accordion3" aria-expanded="false" aria-controls="accordion3" class="accordion-title accordionTitle js-accordionTrigger" style ="font-size: 22px; padding: 20px;">
                  ABOUT
                </a>
              </dt>
              <dd class="accordion-content accordionItem is-collapsed" id="accordion3" aria-hidden="true" >
                <p><a href="http://www.watchlist.org" target="_blank" style= "color: blue;">Watchlist on Children and Armed Conflict</a> strives to end strives to end violations against children in armed conflicts and to guarantee their rights. As a global network, the Watchlist builds partnerships among local, national, and international nongovernmental organizations, enhancing mutual capacities and strengths. Working together, we collect and disseminate information on violations against children in conflicts in order to influence key decision-makers to create and implement programs and policies that effectively protect children.</p>
                <p>This project was developed... (let Watchlist determine language)</p>
              </dd>
            </dl>
          </div>
        </div>
    </div>
    
<!-- MEDIA IN SIDEBAR -->
                
      <div class="sidebar-inner">
        <div>
          <span class='data-name'></span>
        </div>
        <div>
          <img class='data-image' />
        </div>
      </div>
    </div>
        
<script>

<!-- GET MAP FROM CARTO -->
    
  var pointsLayer;
  var polyLayer;
  var leafletMap;
    
  $(document).ready(function () {
    cartodb.createVis('map', 'https://thenewschool.carto.com/u/smitg916/api/v2/viz/6cddd90c-3b65-11e7-acc2-0ee66e2c9693/viz.json', {
          zoom: 7,
          search: false,
          cartodb_logo:false,
          center_lat: 16.247798,
          center_lon: 46.6255705,
          scrollwheel: true,
          layer_selector: false,
          infowindow: true,
          zoomControl: false
    }) 
    .done(function (vis, layers) {
      vis.getNativeMap().addControl(L.control.zoom());
      leafletMap = vis.getNativeMap();
      polyLayer = layers[1].getSubLayer(0);
      pointsLayer = layers[1].getSubLayer(1);
      polyLayer.setInteraction(true);
      pointsLayer.setInteraction(true);
            
 // SCRIPT FOR LAYER CHECK BUTTONS
    
 $('.points-checkbox').change(function () {
          if ($('.points-checkbox').prop('checked')) {
                      pointsLayer.show();
          }
          else {
                  pointsLayer.hide();
          }
        });
        
$('.poly-checkbox').change(function () {
          if ($('.poly-checkbox').prop('checked')) {
                     polyLayer.show();
          }
          else {
                      polyLayer.hide();
          }
        });
            
            
  // SCRIPT FOR POINTS FILTER CHECK BUTTONS
  $('.airstrike-checkbox').change(function () {
    updateSql();
  });
  $('.ground-checkbox').change(function () {
    updateSql();
  });
  $('.indiscriminate-checkbox').change(function () {
    updateSql();
  });
     
      // Update the SQL for the layer based on the current state of the checkboxes.
         function updateSql() {
        var sql = "SELECT * FROM smitg916.health_facility_attacks";
        var whereConditions = [];
       if ($('.airstrike-checkbox').prop('checked')) {
          whereConditions.push("attack_type = 'airstrike'");
        }
        if ($('.ground-checkbox').prop('checked')) {
          whereConditions.push("attack_type = 'ground'");
        }
        if ($('.indiscriminate-checkbox').prop('checked')) {
          whereConditions.push("attack_type = 'indiscriminate'");
        }
        
        // If there are any whereConditions, we add WHERE to the SQL statement and the conditions
        if (whereConditions.length > 0) {
          // Then we combine them with ' OR ', so any of the conditions can be true.
          sql += ' WHERE ' + whereConditions.join(' OR ');
        }
        // Leaving this console.log() here so we can make sure we get valid SQL.
        console.log(sql);
        pointsLayer.setSQL(sql);
      }           
    
            
<!-- PUT MEDIA IN SIDEBAR -->
    
 // Set which columns you want from the dataset when a feature is clicked. This is a comma-separated list.
            pointsLayer.set({
              interactivity: 'media_1,media_2'
            });

            // When a feature is clicked, put the data in the sidebar
            pointsLayer.on('featureClick', function(e, latlng, pos, data) {
              // You can handle any text like this:
              $('.data-name').text(data.name);
              
              // If you have attributes (like an <img> src) do so this way:
              $('.data-image').attr('src', data.image_url);
            });    
            
<!-- CUSTOM INFOWINDOW FOR POINTS LAYER -->              
  
   
   var popupTemplate =  '<div class="cartodb-popup v2"> <a href="#close" class="cartodb-popup-close-button close">x</a> <div class="cartodb-popup-content-wrapper"> <div class="cartodb-popup-content"><div>A(n) {{attack_or_disruption}} in the governorate of {{governorate}} on {{attack_date}} at the {{facility_name}} facility <a href="{{report_link}}" target="_blank" style="color: #3be4f7;">as reported by {{report_org}}</a>.</div> <div><h3>Reported combatant(s)</h3> {{combatant_1}} </div> <div><h3>Reported casualties</h3>Killed: {{tot_k}}</div> <div>Injured: {{tot_i}}</div> <div> <h3>Level of Precision</h3>{{precision_1}}  </div> <div> <h3>Detailed Description</h3>{{description}}</div> <div><h3>Media</h3> {{#media_1}}{{#media_1}}<img style="width: 100%;height:150px;" src="{{media_1}}"/>{{/media_1}}{{#media_2}}<img style="width: 100%px;height:150px;" src="{{media_2}}"/>{{/media_2}} </div>{{/media_1}}<div></div></div> </div>';
               
          pointsLayer.setInteractivity('cartodb_id');
            pointsLayer.infowindow.set('template_type', 'mustache');
            pointsLayer.infowindow.set('template', popupTemplate);

    
 // CUSTOM INFOWINDOW FOR POLY LAYER
    
  var polygonPopupTemplate =  '<div class="cartodb-popup v2"> <a href="#close" class="cartodb-popup-close-button close">x</a> <div class="cartodb-popup-content-wrapper"> <div style="padding-bottom: 10px;" class="cartodb-popup-content"><h4>Governorate Name</h4>{{admin1name}} </div><div><h3>Population:</h3>{{current_es}}</div><div><h3>Est % of health facilities operating at diminished capacity</h3>{{hf_op_dimi}}% </div><div><h3>Est # of conflict indicents</h3>{{conflict_i}} </div><div><h3>Est # of Child Rights Violations</h3>{{chldrn_rig}} </div><div><h3>Est # of people in need</h3>{{people_in_}}</div></div>';
               
  polyLayer.setInteractivity('cartodb_id, admin1name');
  polyLayer.infowindow.set('template_type', 'mustache');
  polyLayer.infowindow.set('template', polygonPopupTemplate);
    
  // SCRIPT FOR ZOOM BUTTONS
  
  $('.Sanaa').click(function () {
    leafletMap.setView([15.369445, 44.191007], 12);
  });
    
 $('.Yemen').click(function () {
    leafletMap.setView([16.247798, 46.6255705], 7);
  });    
   
 $('.Hajjah').click(function () {
    leafletMap.setView([15.703040, 43.603930], 14);
  });
    
$('.Harad').click(function () {
    leafletMap.setView([16.4062392, 43.0404208], 14);
  });     
    
 $('.Sadah').click(function () {
    leafletMap.setView([16.950941, 43.747774], 12);
  }); 
    
 $('.Taiz').click(function () {
    leafletMap.setView([13.577589, 43.957799], 12);
  }); 
    
 $('.Aden').click(function () {
    leafletMap.setView([12.810655, 45.0151118], 13);
 });     

    
    }); // These two lines are the end of createVis.done--anything dealing with the map should happen before here
  }); 
     
 // SCRIPT FOR SIDEPANEL ACCORDION
        
(function(){
  var d = document,
  accordionToggles = d.querySelectorAll('.js-accordionTrigger'),
  setAria,
  setAccordionAria,
  switchAccordion,
  touchSupported = ('ontouchstart' in window),
  pointerSupported = ('pointerdown' in window);
  
  skipClickDelay = function(e){
    e.preventDefault();
    e.target.click();
  }

    setAriaAttr = function(el, ariaType, newProperty){
    el.setAttribute(ariaType, newProperty);
  };
  setAccordionAria = function(el1, el2, expanded){
    switch(expanded) {
      case "true":
        setAriaAttr(el1, 'aria-expanded', 'true');
        setAriaAttr(el2, 'aria-hidden', 'false');
        break;
      case "false":
        setAriaAttr(el1, 'aria-expanded', 'false');
        setAriaAttr(el2, 'aria-hidden', 'true');
        break;
      default:
        break;
    }
  };
    
switchAccordion = function(e) {
  console.log("triggered");
  e.preventDefault();
  var thisAnswer = e.target.parentNode.nextElementSibling;
  var thisQuestion = e.target;
  if(thisAnswer.classList.contains('is-collapsed')) {
    setAccordionAria(thisQuestion, thisAnswer, 'true');
  } else {
    setAccordionAria(thisQuestion, thisAnswer, 'false');
  }
    thisQuestion.classList.toggle('is-collapsed');
    thisQuestion.classList.toggle('is-expanded');
    thisAnswer.classList.toggle('is-collapsed');
    thisAnswer.classList.toggle('is-expanded');
   
    thisAnswer.classList.toggle('animateIn');
  };
  for (var i=0,len=accordionToggles.length; i<len; i++) {
    if(touchSupported) {
      accordionToggles[i].addEventListener('touchstart', skipClickDelay, false);
    }
    if(pointerSupported){
      accordionToggles[i].addEventListener('pointerdown', skipClickDelay, false);
    }
    accordionToggles[i].addEventListener('click', switchAccordion, false);
  }
})();    
     
</script>     

<script src="https://cartodb-libs.global.ssl.fastly.net/cartodb.js/v3/3.15/cartodb.js"></script>
</html>

