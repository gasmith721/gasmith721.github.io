 <!doctype html>
<html>

<head>

<script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>

<!-- Load Carto's code so we can pull in our Carto maps. -->

  <!-- EB removed this: it overrides too many styles -->
  <!-- <link rel="stylesheet" href="https://cartodb-libs.global.ssl.fastly.net/cartodbui/assets/4.6.25/stylesheets/deep_insights.css" /> -->
    
<link rel="stylesheet" href="https://cartodb-libs.global.ssl.fastly.net/cartodb.js/v3/3.15/themes/css/cartodb.css" />
    
  <!-- EB removed this: it's going to break the legend a bit, but this code overrides too many styles -->
  <!-- <link rel="stylesheet" href="https://cartodb-libs.global.ssl.fastly.net/cartodbui/assets/4.6.25/stylesheets/public_editor3.css" /> -->
       
 <link rel="stylesheet" type="text/css"
      href="https://fonts.googleapis.com/css?family=Cardo">
    
<link rel="stylesheet" type="text/css"
      href="https://fonts.googleapis.com/css?family=Garamond">

<link rel="stylesheet" type="text/css"
      href="https://fonts.googleapis.com/css?family=Lato">
    
<link rel="stylesheet" type="text/css"
      href="https://fonts.googleapis.com/css?family=Roboto">    
    
    
<style>
html, body {
    height: 100%;
    margin: 0;
    padding: 0;
    width: 100%;
}
#map {
    height: 100%;
    width: 100%;
}
#header {
    position: absolute;
    right: 0;
    display: flex;
    width: 72.5%;
    z-index:5;
    overflow: hidden;
    height: 63px;
    background-color: rgba(0,0,0,.34);
    justify-content: center;
    vertical-align: middle;
    align-content: center;
}
    
.sidepanel {
    background-color: #FFF;
    position: absolute;
    left: 0;
    bottom: 0;
    width: 27.5%;
    height: 100%;
    overflow: auto;
    display: flex;
    z-index: 5;
    border-right: solid #585858 1px;
}
    
.wrapper {
    display: block;
    padding: 4px 30px 0 30px; 
}    
 
#title-text {
    border-bottom: 5px solid black;
    border-bottom-style:double;
    text-align: center;
    font-size: 32px; 
    font-family: Lato;
    color: #b00836; 
}
    
.leaflet-left {
    left: 28%;
    top: 9.3%;
    position: absolute;
    }
 
/* CHECKBOX FILTERS */
.boxes {
    margin: auto;
    padding-top: 12px;
    padding-left: 12px;
    padding-right: 12px;
    padding-bottom: 12px;
    position: absolute;
        top: 13.2%;
        right: .375%;
    border-radius: 6px;
    width: 200px;
    border:1px solid #021a40; 
    background-color: #fff;
   -moz-box-shadow:    inset 0 0 2.5px #000000;
   -webkit-box-shadow: inset 0 0 2.5px #000000;
   box-shadow:         inset 0 0 2.5px #000000;
}
input[type="checkbox"] { display: none; }
input[type="checkbox"] + label {
  display: block;
  position: relative;
  padding-left: 35px;
  margin-bottom: 20px;
  font: 13px 'Lato', Arial, sans-serif;
  font-weight: 900;
  color: black;
  cursor: pointer;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
}
input[type="checkbox"] + label:last-child { margin-bottom: 0; }
input[type="checkbox"] + label:before {
  content: '';
  display: block;
  width: 16px;
  height: 16px;
  border: 2px solid #b00836;
  position: absolute;
  left: 0;
  top: 0;
  opacity: .6;
  -webkit-transition: all .12s, border-color .08s;
  transition: all .12s, border-color .08s;
}
input[type="checkbox"]:checked + label:before {
  width: 10px;
  top: -5px;
  left: 5px;
  border-radius: 0;
  opacity: 1;
  border-top-color: transparent;
  border-left-color: transparent;
  -webkit-transform: rotate(45deg);
  transform: rotate(45deg);
}     
    
/* ZOOM BUTTONS */
    
.buttons {
    position: absolute;
     left: 50%;
     top: 9.2%;
    display: inline-block;
}
    
.Yemen {
    border: none;
    text-align: center;
    text-decoration: none;
         font-size: 16px;
    background: none;
    font-weight: bolder;
    margin: 4px 2px;
    -webkit-transition-duration: 0.4s; /* Safari */
    transition-duration: 0.4s;
    cursor: pointer;
    color: black; 
    border: 2px solid #b00836;
    padding: 5px;
    font-family: 'Lato';
}
.Yemen:hover {
    background-color: #b00836;
    color: white;
}
.Yemen:focus {
    background-color: #b00836;
    color: white;
}    
.Sadah {
    border: none;
    text-align: center;
    text-decoration: none;
        font-size: 16px;
    background: none;
    font-weight: bolder;
    margin: 4px 2px;
    -webkit-transition-duration: 0.4s; /* Safari */
    transition-duration: 0.4s;
    cursor: pointer;
    color: black; 
    border: 2px solid #b00836;
    padding: 5px;
    font-family: 'Lato';
}
.Sadah:hover {
    background-color: #b00836;
    color: white;
}
.Sadah:focus {
    background-color: #b00836;
    color: white;
}
    
.Hajjah {
    border: none;
    text-align: center;
    text-decoration: none;
        font-size: 16px;
    background: none;
    font-weight: bolder;
    margin: 4px 2px;
    -webkit-transition-duration: 0.4s; /* Safari */
    transition-duration: 0.4s;
    cursor: pointer;
    color: black; 
    border: 2px solid #b00836;
    padding: 5px;
    font-family: 'Lato';
}
.Hajjah:hover {
    background-color: #b00836;
    color: white;
}
.Hajjah:focus {
    background-color: #b00836;
    color: white;
}
.Harad {
    border: none;
    text-align: center;
    text-decoration: none;
     font-size: 16px;
    background: none;
    font-weight: bolder;
    margin: 4px 2px;
    -webkit-transition-duration: 0.4s; /* Safari */
    transition-duration: 0.4s;
    cursor: pointer;
    color: black; 
    border: 2px solid #b00836;
    padding: 5px;
    font-family: 'Lato';
}
.Harad:hover {
    background-color: #b00836;
    color: white;
}
.Harad:focus {
    background-color: #b00836;
    color: white;
}     
    
.Sanaa {
    border: none;
    text-align: center;
    text-decoration: none;
        font-size: 16px;
    background: none;
    font-weight: bolder;
    margin: 4px 2px;
    -webkit-transition-duration: 0.4s; /* Safari */
    transition-duration: 0.4s;
    cursor: pointer;
    color: black; 
    border: 2px solid #b00836;
    padding: 5px;
    font-family: 'Lato';
}
.Sanaa:hover {
    background-color: #b00836;
    color: white;
}
.Sanaa:focus {
    background-color: #b00836;
    color: white;
}   
    
.Taiz {
    border: none;
    text-align: center;
    text-decoration: none;
      font-size: 16px;
    background: none;
    font-weight: bolder;
    margin: 4px 2px;
    -webkit-transition-duration: 0.4s; /* Safari */
    transition-duration: 0.4s;
    cursor: pointer;
    color: black; 
    border: 2px solid #b00836;
    padding: 5px;
    font-family: 'Lato';
}
.Taiz:hover {
    background-color: #b00836;
    color: white;
}
.Taiz:focus {
    background-color: #b00836;
    color: white;
}
    
.Aden {
    border: none;
    text-align: center;
    text-decoration: none;
        font-size: 16px;
    background: none;
    font-weight: bolder;
    margin: 4px 2px;
    -webkit-transition-duration: 0.4s; /* Safari */
    transition-duration: 0.4s;
    cursor: pointer;
    color: black; 
    border: 2px solid #b00836;
    padding: 5px;
    font-family: 'Lato';
}
.Aden:hover {
    background-color: #b00836;
    color: white;
}
.Aden:focus {
    background-color: #b00836;
    color: white;
}      
/* END ZOOM BUTTON STYLING */
    
    
/* ACCORDION STYLING */    
 
* {
  box-sizing:border-box;
}
@import url(http://fonts.googleapis.com/css?family=Lato:400,700);
body { 
  font-family:'Lato';
}
.heading-primary {
  font-size: 22px;
  padding:2em;
  text-align:center;
}
.accordion dl,
    .accordion-list {
   border:1px solid #ddd;
   &:after {
       content: "";
       display:block;
       height:1em;
       width:100%;
       background-color:darken(#b00836, 50%);
     }
}
.accordion dd,
.accordion__panel {
   background-color:#eee;
   font-size: 14px;
   line-height:1.5em; 
}
.accordion p {
  padding: 0em 2em 0em 0em;
}
.accordion {
    position:relative;
    background-color:#eee;
}
.container {
  max-width:960px;
  margin:0 auto;
    background-color: #fff;
}
.accordionTitle {
 background-color: #fff; 
   text-align:center;
     font-weight:700; 
          padding:2em;
          display:block;
          border:3px solid #b00836;    
          text-decoration:none;
          color: black;
          transition:background-color 0.5s ease-in-out;
}
.accordionTitle:hover {
    background-color: #b00836;
    color: white;
}
 
    
.accordionTitleActive,
.accordionTitle.isexpanded {
        background-color: #b00836;
    color: black;
    }
    
.accordionTitleActive,
.accordionTitle.is-collapsed {
        background-color: #b00836;
    color: white;
    }     
    
/*.accordionTitle:before {
          content: "+";
   font-size:1.5em;
   line-height:0.5em;
   float:left; 
   transition: transform 0.3s ease-in-out;
    }*/
      
.accordionItem {
    height:auto;
    overflow:hidden; 
    //SHAME: magic number to allow the accordion to animate
    
     max-height:50em;
    transition:max-height 1s;   
 
    
    @media screen and (min-width:48em) {
         max-height:15em;
        transition:max-height 0.5s
        
    }
      
}
 
.accordionItem.is-collapsed {
    max-height:0;
}
.no-js .accordionItem.is-collapsed {
  max-height: auto;
}
.animateIn {
     animation: accordionIn 0.45s normal ease-in-out both 1; 
}
.animateOut {
     animation: accordionOut 0.45s alternate ease-in-out both 1;
}
@keyframes accordionIn {
  0% {
    opacity: 0;
    transform:scale(0.9) rotateX(-60deg);
    transform-origin: 50% 0;
  }
  100% {
    opacity:1;
    transform:scale(1);
  }
}
@keyframes accordionOut {
    0% {
       opacity: 1;
       transform:scale(1);
     }
     100% {
          opacity:0;
           transform:scale(0.9) rotateX(-60deg);
       }
}   
/* 'ZOOM TO' DIV */    
#inner{
   width: 80%;
  margin: 0 auto;
    font-family: Lato;
  text-align: center;
    font-size: 22px; 
    text-transform: uppercase; 
    font-weight:900; 
    color:#b00836;
    -webkit-text-stroke: .25px black;
       }   
    
.sidebar-inner {
        padding: 15px;
    
      }    
.bullet1 {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    display: inline-block;
  }
    
.legend-list {
    list-style-type: none;
    text-align: left;
    margin-left: -40px;
    }
    
/* INFOWINDOWS */
    
.cartodb-popup.v2 {
    width:400px;
    max-height:425px;
     padding: 10px; 
    border-radius: 8px;
    color: white;
    font-family: Lato;
    font-size: 13px;
    }
    
  /* EB: this is for the scrollbar in the popups */
  div.cartodb-popup .jspDrag {
    background: #b00836;
  }
  div.cartodb-popup .jspDrag:hover {
    background: #b00836;
  }    
    
.cartodb-popup-v3 {
    width:300px;
    max-height:450px;
     padding: 10px; 
    background: #222222;
    overflow-y:scroll;
    border-radius: 8px;
    color: white;
    font-family: Lato;
    font-size: 13px;
    }    
  div.cartodb-popup.v2 div.cartodb-popup-content-wrapper {
    padding-bottom: 14px;
    background-color: #222222;
  }
  
  div.cartodb-popup .jspContainer:after {
    background: none;
  }
  
  div.cartodb-popup .jspContainer:before {
    background: none;
  }
    
.cartodb-popup-v3 {
    width:250px;
    max-height:400px;
     padding: 10px; 
    background: #2E3C43;
    overflow-y:scroll;
    border-radius: 10px;
    color: white;
    }    
 
 div.cartodb-popup.v2 h3 {
    color: grey;
    text-transform:uppercase;
    font-size: 13px;
    padding-top: 15px;
     font-family: Lato;
    }   
    
 div.cartodb-popup.v2 h4 {
    color: grey;
    text-transform:uppercase;
    font-size: 13px;
      font-family: Lato;
    }     
    
</style>
    
</head>

<!-- HEADER -->    
    
<div id="header">
    <a href="http://watchlist.org/" target="_blank"> <img src="http://watchlist.org/wp-content/uploads/header-logo.png" width="300" height="62"> </a>
    </div>     
    
<!-- MAP -->    
    
<div id="map"></div>
    
<!-- ZOOM TO BUTTONS -->
    
  <div class="buttons">
    <div id="inner">Zoom to:</div>  
        <button class="Yemen">Yemen</button>
        <button class="Sadah">Sa'dah</button>
        <button class="Hajjah">Hajjah</button>
        <button class="Harad">Harad</button>
        <button class="Sanaa">Sana'a</button>
        <button class="Taiz">Taiz</button>
        <button class="Aden">Aden</button>
  </div>
    

<!-- CHECKBOX FOR LAYERS -->  
    
  <div class="boxes" style="padding-bottom:none;">
       <div class="legend-title" style="font-family: Lato; font-weight: 900; text-align: center; color: black; font-size: 15px; text-transform: none;padding-bottom:14px;font-weight: 800;" >Map Layer Selector</div> 
        
        <input type="checkbox" id="poly" class="poly-checkbox" checked="true">
  <label for="poly">governorate-level</label>
      
      <input type="checkbox" id="points" class="points-checkbox" checked="true">
  <label for="points">individual attacks</label>
      
    
<!--    POLYGON LEGEND -->
    
<span style= "padding-bottom:none;" class="cartodb-legend category">       
      
    <div class="legend-title" style="font-family: Lato; font-weight: 900; text-align: center; color: black; font-size: 14px; text-transform: none;border-top: 3px solid black;border-top-style:;padding-top: 10px;" >% of Health Facilities at Diminished Capacity</div>
            
    <ul class ="legend-list" style="color:black;">
  
      <li style="font-size:14px;font-family:Cardo;font-weight:900;color:black;padding-bottom:2px;">
        <div class="bullet1" style="background-color:#ee4d5a;"></div>
        >75%
     </li>
      
      <li style="font-size:14px;font-family:Cardo;font-weight:bold;color:black;padding-bottom:2px;">
        <div class="bullet1" style="background-color:#f97b57;"></div>
        50% - 75%
      </li>
      
      <li style="font-size:14px;font-family:Cardo;font-weight:bold;color:black;padding-bottom:2px;">
          <div class="bullet1" style="background-color:#f3ad6a"></div> 25% - 49%
      </li>
        
      <li style="font-size:14px;font-family:Cardo;font-weight:bold;color:black;padding-bottom:2px;">
        <div class="bullet1" style="background-color:#ecda9a;" ></div>
        less than 25%
       </li>
        
         <li style="font-size:14px;font-family:Cardo;font-weight:bold;color:black;padding-bottom:2px;">
        <div class="bullet1" style="background-color:#bdc0c4;" ></div>
        Unavailable
       </li>
        
     </ul>
   </span>    
    

      
        


 <!--    POINTS LEGEND -->

  <div class="legend-title" style="font-family: Lato; font-weight: 900; text-align: center; color: black; font-size: 15px; text-transform: none;padding-top: 10px;border-top: 3px solid black;border-top-style:;" >Health Facility Disruptions</div> 
   
<ul class="legend-list">
      <li><div class="image" style="font-size: 14px; font-weight: 900; text-transform: lowercase; margin-bottom: 10px; font-family: Cardo; color:#b00836;">
<a href=""><img style= "vertical-align:middle" img src="https://d30y9cdsu7xlg0.cloudfront.net/png/163336-200.png" width="20" height="20" alt=""></a> airstrike</div></li>
      
    <li><div class="bullet" style="font-size: 14px; font-weight: 900; text-transform: lowercase; margin-bottom: 10px; font-family: Cardo; color:#b00836; font-weight: bold;">
<a href=""><img style= "vertical-align:middle" img src="https://d30y9cdsu7xlg0.cloudfront.net/png/659093-200.png" width="20" height="20" alt=""></a> ground attack</div></li>
      
    <li><div class="bullet" style="font-size: 14px; font-weight: 900; text-transform: lowercase; font-family: Cardo; color:#b00836; font-weight: bold;">
<a href=""><img style= "vertical-align:middle; color:#b00836;" img src="https://d30y9cdsu7xlg0.cloudfront.net/png/756341-200.png" width="20" height="20" alt=""></a>
unidentified disruption</div></li>
  </ul>
        
<!-- CHECKBOX FOR FILTERING POINTS -->  
   

     <div class="legend-title" style="font-family: Lato; font-weight: 900; text-align: center; color: black; font-size: 15px; text-transform: none;padding-bottom:14px;padding-top:12px;border-top: 3px solid black;border-top-style:;" >Filter Attacks by Type</div> 
  <input type="checkbox" id="airstrike" class="airstrike-checkbox">
  <label for="airstrike">airstrike</label>

  <input type="checkbox" id="ground" class="ground-checkbox">
  <label for="ground">ground</label>

  <input type="checkbox" id="indiscriminate" class="indiscriminate-checkbox">
  <label for="indiscriminate">unidentified</label>

 </div>  
  
    
<!-- SIDEPANEL -->    
    
<div id="side-box" class="sidepanel">
    <div class="wrapper">
        <div id="title-text">
            <h1>YEMEN</h1>
                    </div>
            <div id="sidebar">
                
        
<!-- ACCORDION -->            

<div class="container" style= "padding-top: 15px;">
  <div class="accordion">
    <dl>
      <dt>
       
        <a href="#accordion2" aria-expanded="false" aria-controls="accordion2" class="accordion-title accordionTitle js-accordionTrigger" style ="font-size: 22px; padding: 20px;">
                  METHODS</a>
              </dt>
              <dd class="accordion-content accordionItem is-collapsed" id="accordion2" aria-hidden="true" style="padding: 5px;">
    <p>As part of a spatial analysis of risks to civilian infrastructure within the conflict in Yemen, <a href="http://watchlist.org/" target="_blank">Watchlist on Children and Armed Conflict</a> has compiled data and statistics from reports by a number of different organizations (OCHA, WHO, MSF, other NGOs, media outlets, etc.) from March 2015 thru June 2016. The resulting map includes instances of individual attacks, lootings, and/or other violent disruptions inflicted upon healthcare facilities, as well as aggregate healthcare statistics at the governorate (i.e. province/state) level. Consistent data was not available for every governorate thus the exact date that figures on this level were captured vary throughout the 15-month time period.</p>                
   <p>Over this period, and as detailed in this map, Watchlist has identified 52 instances of an attack or disruption supported by official reporting (with many more undocumented attacks, lootings, and/or disruptions estimated). </p> 
                <p>Clicking directly on any of these incidents provides additional details, including a link to the supporting report. Likewise, health and other statistics at the governorate level can be accessed at the governorate level by clicking on any governorate. </p>
   <p>For a number of the individual incidents, the facility was either unnamed in the report or it was unable to be located on existing maps. The level of precision varies by incident â€” anywhere from rooftop, neighborhood, town/city, and (where information is most scarce) the governorate level. Thus, some of the points on the map do not represent the actual location of that specific attack. The precision level is available in the infowindow of each point on the map.  </p>            
   <p>The individual incidents can be filtered by attack type by choosing any of the three checkboxes: airstrike, ground attack, or unidentified. Both map layers can also be turned on or off by using selector located above the attack filter. Unchecking the governorate data layer, for instance, will leave just the individual attack data layer, which is then visible on top of satellite imagery, providing the user with a street-level perspective of where attacks occurred. </p>          
   <p>Due to gaps in the reporting process caused by the overall difficulty of data collection in Yemen, these incidents make up only a fraction of the total number of health facility attacks.</p>
              </dd>
        
              <dt>
                <a href="#accordion3" aria-expanded="false" aria-controls="accordion3" class="accordion-title accordionTitle js-accordionTrigger" style ="font-size: 22px; padding: 20px;">
                  ABOUT
                </a>
              </dt>
              <dd class="accordion-content accordionItem is-collapsed" id="accordion3" aria-hidden="true" >
                <p>This project was developed as a collaboration between Watchlist and the Milano School of International Affairs at The New School in NYC.</p>

                  <p><b>Mapping Faculty Advisors:</b>
                      <br>Eric Brelsfod
                      <br>Stephen Metts
                                       </p>
                     
                  <p><b>Mapping Project Developers:</b>
                      <br>Julian Lattimore
                      <br>Jalita Moore
                      <br>Gregory Smith
                                       </p>                 
<p>- <i>M.A. Graduate Students, The New School</i> </p>                  

              </dd>
            </dl>
          </div>
        </div>
    </div>
        
<script>
<!-- GET MAP FROM CARTO -->
    
  var pointsLayer;
  var polyLayer;
  var leafletMap;
  
  $(document).ready(function () {
    cartodb.createVis('map', 'https://thenewschool.carto.com/u/smitg916/api/v2/viz/52024b33-9acd-4773-87e4-a5e5b12bee66/viz.json', {
          zoom: 6,
          search: false,
          cartodb_logo:false,
          center_lat: 16.077798,
          center_lon: 45.0355705,
          scrollwheel: true,
          layer_selector: false,
          infowindow: true,
          zoomControl: false
    }) 
    .done(function (vis, layers) {
      vis.getNativeMap().addControl(L.control.zoom());
      leafletMap = vis.getNativeMap();
      polyLayer = layers[1].getSubLayer(0);
      pointsLayer = layers[1].getSubLayer(1);
      polyLayer.setInteraction(true);
      pointsLayer.setInteraction(true);       
    
            
 // SCRIPT FOR LAYER CHECK BUTTONS
    
 $('.points-checkbox').change(function () {
          if ($('.points-checkbox').prop('checked')) {
                      pointsLayer.show();
          }
          else {
                  pointsLayer.hide();
          }
        });
        
$('.poly-checkbox').change(function () {
          if ($('.poly-checkbox').prop('checked')) {
                     polyLayer.show();
          }
          else {
                      polyLayer.hide();
          }
        });
            
            
  // SCRIPT FOR POINTS FILTER CHECK BUTTONS
  $('.airstrike-checkbox').change(function () {
    updateSql();
  });
  $('.ground-checkbox').change(function () {
    updateSql();
  });
  $('.indiscriminate-checkbox').change(function () {
    updateSql();
  });
     
      // Update the SQL for the layer based on the current state of the checkboxes.
         function updateSql() {
        var sql = "SELECT * FROM smitg916.hfattacks_yemen";
        var whereConditions = [];
       if ($('.airstrike-checkbox').prop('checked')) {
          whereConditions.push("attack_type = 'airstrike'");
        }
        if ($('.ground-checkbox').prop('checked')) {
          whereConditions.push("attack_type = 'ground'");
        }
        if ($('.indiscriminate-checkbox').prop('checked')) {
          whereConditions.push("attack_type = 'indiscriminate'");
        }
        
        // If there are any whereConditions, we add WHERE to the SQL statement and the conditions
        if (whereConditions.length > 0) {
          // Then we combine them with ' OR ', so any of the conditions can be true.
          sql += ' WHERE ' + whereConditions.join(' OR ');
        }
        // Leaving this console.log() here so we can make sure we get valid SQL.
        console.log(sql);
        pointsLayer.setSQL(sql);
      }           
    
            
<!-- PUT MEDIA IN SIDEBAR -->
    
 // Set which columns you want from the dataset when a feature is clicked. This is a comma-separated list.
//            pointsLayer.set({
//              interactivity: 'media_1,media_2'
//            });
            // When a feature is clicked, put the data in the sidebar
//            pointsLayer.on('featureClick', function(e, latlng, pos, data) {
              // You can handle any text like this:
//              $('.data-name').text(data.name);
              
              // If you have attributes (like an <img> src) do so this way:
//              $('.data-image').attr('src', data.image_url);
//            });    
    
        
 <!-- MEDIA IN SIDEBAR (ALTERNATIVE) -->
                
//      <div class="sidebar-inner">
//        <div>
//          <span class='data-name'></span>
//        </div>
//        <div>
//          <img class='data-image' />
//        </div>
//      </div>
//    </div>
            
<!-- CUSTOM INFOWINDOW FOR POINTS LAYER -->              
  
  // EB you have to give the video a height (in pixels) otherwise it's not going to show up
   
   var popupTemplate =  '<div class="cartodb-popup v2"> <a href="#close" class="cartodb-popup-close-button close">x</a> <div class="cartodb-popup-content-wrapper"> <div class="cartodb-popup-content"><div>A(n) {{attack_or_disruption}} in the governorate of {{governorate}} on {{attack_date}} at the {{facility_name}} facility <a href="{{report_link}}" target="_blank" style="color: #3be4f7;">as reported by {{report_org}}</a>.</div> <div><h3>Reported combatant(s)</h3> {{combatant_1}} </div> <div><h3>Reported casualties</h3>Killed: {{tot_k}}</div> <div>Injured: {{tot_i}}</div> <div> <h3>Level of Precision</h3>{{precision_1}}  </div> <div> <h3>Detailed Description</h3>{{description}}</div> <div><h3>Media</h3> {{#media_1}}{{#media_1}}<img style="width: 300px;height:200px;" src="{{media_1}}"/>{{/media_1}} {{#media_2}}<img style="width: 300px;height:200px;" src="{{media_2}}"/>{{/media_2}}  {{#media_3}}<img style="width: 300px;height:200px;" src="{{media_3}}"/>{{/media_3}} {{#media_4}}<img style="width: 300px;height:200px;" src="{{media_4}}"/>{{/media_4}} {{#media_5}}<img style="width: 300px;height:200px;" src="{{media_5}}"/>{{/media_5}} {{#media_6}}<img style="width: 300px;height:200px;" src="{{media_6}}"/>{{/media_6}} {{#media_7}}<img style="width: 300px;height:200px;" src="{{media_7}}"/>{{/media_7}} {{#media_8}}<img style="width: 300px;height:200px;" src="{{media_8}}"/>{{/media_8}} {{#media_9}}<img style="width: 300px;height:200px;" src="{{media_9}}"/>{{/media_9}} {{#media_10}}<img style="width: 300px;height:200px;" src="{{media_10}}"/>{{/media_10}}</div>{{/media_1}}<div></div><div><h3>Video</h3><p>{{#video_1}}<iframe width="300px" height="230px" src="{{video_1}}" frameborder="0" allowfullscreen></iframe>{{/video_1}}</p><p>{{#video_2}}<iframe width="300px" height="230px" src="{{video_2}}" frameborder="0" allowfullscreen></iframe>{{/video_2}}</p></div></div></div></div>';
               
pointsLayer.setInteractivity('cartodb_id');
pointsLayer.infowindow.set('template_type', 'mustache');
pointsLayer.infowindow.set('maxHeight', 400);
pointsLayer.infowindow.set('width', 333);
// EB: you want to use popupTemplate here, since it has the code itself you don't have to ask it for the html
pointsLayer.infowindow.set('template',  popupTemplate);
pointsLayer.infowindow.set('sanitizeTemplate', false); 
        
        
 // CUSTOM INFOWINDOW FOR POLY LAYER
    
  var polygonPopupTemplate =  '<div class="cartodb-popup v2"> <a href="#close" class="cartodb-popup-close-button close">x</a> <div class="cartodb-popup-content-wrapper"> <div class="cartodb-popup-content"><h4>Governorate Name</h4>{{admin1name}} </div><div><h3>Est. Population</h3>{{current_es}}</div><div><h3>Est. % of health facilities operating at diminished capacity</h3>{{hf_op_dimi}} </div><div><h3>Healthworkers per 10,000</h3>{{healthwork}} </div><div><h3>Est. # of conflict incidents</h3>{{conflict_i}} </div><div><h3>Est. # of Child Rights Violations</h3>{{chldrn_rig}} </div><div><h3>Est. # of people in need</h3>{{people_in_}}</div></div>';
               
  polyLayer.setInteractivity('cartodb_id, admin1name');
  polyLayer.infowindow.set('template_type', 'mustache');
  polyLayer.infowindow.set('template', polygonPopupTemplate);
  polyLayer.infowindow.set('maxHeight', 400);
  polyLayer.infowindow.set('width', 250);        
    
  // SCRIPT FOR ZOOM BUTTONS
  
  $('.Sanaa').click(function () {
    leafletMap.setView([15.369445, 44.191007], 12);
  });
    
 $('.Yemen').click(function () {
    leafletMap.setView([16.277798, 46.4155705], 7);
  });    
   
 $('.Hajjah').click(function () {
    leafletMap.setView([15.703040, 43.603930], 14);
  });
    
$('.Harad').click(function () {
    leafletMap.setView([16.4062392, 43.0404208], 14);
  });     
    
 $('.Sadah').click(function () {
    leafletMap.setView([16.950941, 43.747774], 12);
  }); 
    
 $('.Taiz').click(function () {
    leafletMap.setView([13.577589, 43.957799], 12);
  }); 
    
 $('.Aden').click(function () {
    leafletMap.setView([12.810655, 45.0151118], 13);
 });     
    
    }); // These two lines are the end of createVis.done--anything dealing with the map should happen before here
     
 // SCRIPT FOR SIDEPANEL ACCORDION
        
(function(){
  var d = document,
  accordionToggles = d.querySelectorAll('.js-accordionTrigger'),
  setAria,
  setAccordionAria,
  switchAccordion,
  touchSupported = ('ontouchstart' in window),
  pointerSupported = ('pointerdown' in window);
  
  skipClickDelay = function(e){
    e.preventDefault();
    e.target.click();
  }
    setAriaAttr = function(el, ariaType, newProperty){
    el.setAttribute(ariaType, newProperty);
  };
  setAccordionAria = function(el1, el2, expanded){
    switch(expanded) {
      case "true":
        setAriaAttr(el1, 'aria-expanded', 'true');
        setAriaAttr(el2, 'aria-hidden', 'false');
        break;
      case "false":
        setAriaAttr(el1, 'aria-expanded', 'false');
        setAriaAttr(el2, 'aria-hidden', 'true');
        break;
      default:
        break;
    }
  };
    
switchAccordion = function(e) {
  console.log("triggered");
  e.preventDefault();
  var thisAnswer = e.target.parentNode.nextElementSibling;
  var thisQuestion = e.target;
  if(thisAnswer.classList.contains('is-collapsed')) {
    setAccordionAria(thisQuestion, thisAnswer, 'true');
  } else {
    setAccordionAria(thisQuestion, thisAnswer, 'false');
  }
    thisQuestion.classList.toggle('is-collapsed');
    thisQuestion.classList.toggle('is-expanded');
    thisAnswer.classList.toggle('is-collapsed');
    thisAnswer.classList.toggle('is-expanded');
   
    thisAnswer.classList.toggle('animateIn');
  };
  for (var i=0,len=accordionToggles.length; i<len; i++) {
    if(touchSupported) {
      accordionToggles[i].addEventListener('touchstart', skipClickDelay, false);
    }
    if(pointerSupported){
      accordionToggles[i].addEventListener('pointerdown', skipClickDelay, false);
    }
    accordionToggles[i].addEventListener('click', switchAccordion, false); 
  }
})(); 
  })
  
      
</script>     

<script src="https://cartodb-libs.global.ssl.fastly.net/cartodb.js/v3/3.15/cartodb.js"></script>
</html>
